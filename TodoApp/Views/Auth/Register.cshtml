
@model TodoApp.Models.RegisterViewModel

@{
    ViewBag.Title = "Register";
}

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="container-fluid h-100 d-flex justify-content-center align-items-center bg-black">
    <div class="col-11 col-md-6 col-lg-4 position-relative d-flex flex-column justify-content-center rounded-2 bg-white p-5">
        <div class="w-100 d-flex flex-column">


            <h2 class="fs-2 fw-semibold">Register</h2>
            <form id="registerForm"
                  class="container-fluid d-flex flex-column align-items-center p-2">

                @Html.AntiForgeryToken()

                <div class="form-group w-100">
                    <label class="form-label">Name</label>
                    <input type="text"
                           name="name"
                           class="form-control w-100"
                           required />
                </div>

                <div class="form-group w-100">
                    <label class="form-label">Email</label>
                    <input type="email"
                           name="email"
                           class="form-control w-100"
                           required />
                </div>

                <div class="form-group w-100">
                    <label class="form-label">Password</label>
                    <input type="password"
                           name="password"
                           class="form-control w-100"
                           required />
                </div>

                <div class="form-group w-100">
                    <input type="submit"
                           value="Submit"
                           class="btn btn-dark mt-3 w-100" />
                </div>
            </form>


            <div class="w-100 d-flex justify-content-end">
                <a href="@Url.Action("Login", "Auth")" class="fs-6 text-primary text-decoration-underline">Already have an account? Login</a>
            </div>

        </div>
    </div>
</div>

@section scripts{

    <script>

        document.getElementById("registerForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const form = e.target;

            const formData = new FormData(form);



            try {
                const response = await fetch('@Url.Action("Register", "Auth")', {
                    method: "POST",
                    headers: { "X-Requested-With": "XMLHttpRequest" }
                    body:formData
                });

                if (response.ok) {
                    const result = await response.json();
                    alert("Register exitoso");
                    window.location.href = result.redirectUrl;
                } else {
                    const error = await response.text();
                    alert(`Error: ${error}`);
                }

            } catch (err) {
                console.error("Error", err);
                alert("Red Error")
            }
        })

    </script>

}
